---
template:
  id: story-template-v2
  name: Story Document
  version: 2.0
  output:
    format: markdown
    filename: docs/stories/1.2.Core-Kubernetes-Node-Parsing.md
    title: "Story 1.2: Core Kubernetes Node Parsing"
workflow:
  mode: interactive
  elicitation: advanced-elicitation
agent_config:
  editable_sections:
    - Status
    - Story
    - Acceptance Criteria
    - Tasks / Subtasks
    - Dev Notes
    - Testing
    - Change Log
---
# Story 1.2: Core Kubernetes Node Parsing

## Status
Draft

## Story
**As a** DevOps Engineer,
**I want** HelmGraph to parse the Kubernetes manifest,
**so that** it identifies and extracts core resource types as graph nodes.

## Acceptance Criteria
1. The tool parses the consolidated Kubernetes manifest, correctly handling multi-document YAML streams.
2. The tool identifies and extracts resources of all `kind`s: e.g. `Deployment`, `Service`, `ConfigMap`, `Secret`.
3. For each identified resource, the tool extracts its `kind`, `metadata.name`, and optionally `metadata.namespace`.
4. The extracted data for each resource is structured appropriately for conversion into a Neo4j node.

## Tasks / Subtasks
- [ ] **Task 1: Implement YAML Parsing.** (AC: 1)
    - [ ] Use the `gopkg.in/yaml.v3` library to parse the multi-document YAML manifest.
- [ ] **Task 2: Define Kubernetes Resource Structs.** (AC: 2, 3, 4)
    - [ ] Create Go structs in `internal/parser/models.go` to represent the generic Kubernetes resource and specific kinds like `Deployment`, `Service`, etc. as defined in the architecture.
- [ ] **Task 3: Implement Resource Extraction.** (AC: 2, 3)
    - [ ] Iterate through the parsed YAML documents and extract the `kind`, `metadata.name`, and `metadata.namespace` for each resource.
    - [ ] Populate the Go structs with the extracted data.
- [ ] **Task 4: Write Unit Tests.**
    - [ ] Write unit tests for the YAML parsing and resource extraction logic.

## Dev Notes
- **YAML Parsing**: The `gopkg.in/yaml.v3` library should be used for parsing the Kubernetes manifests. [Source: docs/architecture/tech-stack.md]
- **Data Models**: The data models for Kubernetes resources are defined in `docs/architecture/data-models.md`. These should be implemented as Go structs in `internal/parser/models.go`.
- **File Locations**: The parsing logic should be implemented in `internal/parser/parser.go`. [Source: docs/architecture/source-tree.md]
- **Previous Story Insights**: This story builds on the manifest generation from story 1.1. The output of that story is the input to this one.

### Testing
- **Unit Tests**: Unit tests should be created in `_test.go` files in the same package as the code they are testing. [Source: docs/architecture/coding-standards.md]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-01 | 1.0 | Initial draft | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}
### Debug Log References
-
### Completion Notes List
-
### File List
-

## QA Results
-
