---
template:
  id: story-template-v2
  name: Story Document
  version: 2.0
  output:
    format: markdown
    filename: docs/stories/1.3.Relationship-Identification-Service-&-Deployment.md
    title: "Story 1.3: Relationship Identification (Service & Deployment)"
workflow:
  mode: interactive
  elicitation: advanced-elicitation
agent_config:
  editable_sections:
    - Status
    - Story
    - Acceptance Criteria
    - Tasks / Subtasks
    - Dev Notes
    - Testing
    - Change Log
---
# Story 1.3: Relationship Identification (Service & Deployment)

## Status
Draft

## Story
**As a** DevOps Engineer,
**I want** HelmGraph to identify relationships between Services and Deployments,
**so that** I can visualize how Services route traffic to specific application instances.

## Acceptance Criteria
1. The tool analyzes `Service` resources to identify their `selector` labels.
2. The tool matches `Service` selectors to `Deployment` resources that have matching labels.
3. For each identified match, the tool establishes a "SELECTS" relationship between the `Service` node and the `Deployment` node.
4. The relationship includes relevant properties, such as the `selector_labels` used for the connection.

## Tasks / Subtasks
- [ ] **Task 1: Implement Relationship Identification Logic.** (AC: 1, 2)
    - [ ] Create a new package `internal/relations` for relationship identification logic.
    - [ ] Implement a function in `internal/relations/identifier.go` that takes the list of parsed resources as input.
    - [ ] Iterate through the resources to find all `Service` and `Deployment` kinds.
    - [ ] For each `Service`, compare its `selector` labels with the `metadata.labels` of each `Deployment`.
- [ ] **Task 2: Create Relationship Structs.** (AC: 3, 4)
    - [ ] Define a Go struct to represent the "SELECTS" relationship, including its properties.
- [ ] **Task 3: Establish and Store Relationships.** (AC: 3, 4)
    - [ ] When a match is found, create an instance of the "SELECTS" relationship struct.
    - [ ] Store the identified relationships for later use by the Cypher generator.
- [ ] **Task 4: Write Unit Tests.**
    - [ ] Write unit tests for the relationship identification logic.

## Dev Notes
- **Data Models**: The data models for Kubernetes resources are defined in `docs/architecture/data-models.md`. The relationship identification logic will operate on the Go structs created in the previous story.
- **File Locations**: The relationship identification logic should be implemented in `internal/relations/identifier.go`. [Source: docs/architecture/source-tree.md]
- **Previous Story Insights**: This story depends on the successful parsing of Kubernetes resources from story 1.2.

### Testing
- **Unit Tests**: Unit tests should be created in `_test.go` files in the same package as the code they are testing. [Source: docs/architecture/coding-standards.md]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-01 | 1.0 | Initial draft | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}
### Debug Log References
-
### Completion Notes List
-
### File List
-

## QA Results
-
