---
template:
  id: story-template-v2
  name: Story Document
  version: 2.0
  output:
    format: markdown
    filename: docs/stories/1.4.Relationship-Identification-Deployment-&-ConfigMap-Secret.md
    title: "Story 1.4: Relationship Identification (Deployment & ConfigMap/Secret)"
workflow:
  mode: interactive
  elicitation: advanced-elicitation
agent_config:
  editable_sections:
    - Status
    - Story
    - Acceptance Criteria
    - Tasks / Subtasks
    - Dev Notes
    - Testing
    - Change Log
---
# Story 1.4: Relationship Identification (Deployment & ConfigMap/Secret)

## Status
Draft

## Story
**As a** DevOps Engineer,
**I want** HelmGraph to identify relationships between Deployments and ConfigMaps/Secrets,
**so that** I can understand which configurations and sensitive data are used by my applications.

## Acceptance Criteria
1. The tool analyzes `Deployment` resources to identify references to `ConfigMap` and `Secret` resources.
2. The tool identifies references through common mechanisms like `volumeMounts`, `envFrom`, and `env` variables.
3. For each identified reference, the tool establishes a "USES_CONFIG" relationship between the `Deployment` node and the `ConfigMap` node, or a "USES_SECRET" relationship between the `Deployment` node and the `Secret` node.
4. The relationships include relevant properties, such as `mount_path` or `env_var_name`, where applicable.

## Tasks / Subtasks
- [ ] **Task 1: Extend Relationship Identification Logic.** (AC: 1, 2)
    - [ ] In `internal/relations/identifier.go`, add logic to iterate through `Deployment` resources.
    - [ ] Analyze `volumeMounts`, `envFrom`, and `env` fields to find references to `ConfigMap` and `Secret` resources.
- [ ] **Task 2: Create Relationship Structs.** (AC: 3, 4)
    - [ ] Define Go structs to represent the "USES_CONFIG" and "USES_SECRET" relationships, including their properties.
- [ ] **Task 3: Establish and Store Relationships.** (AC: 3, 4)
    - [ ] When a reference is found, create an instance of the appropriate relationship struct.
    - [ ] Store the identified relationships for later use by the Cypher generator.
- [ ] **Task 4: Write Unit Tests.**
    - [ ] Write unit tests for the new relationship identification logic.

## Dev Notes
- **Data Models**: The data models for Kubernetes resources are defined in `docs/architecture/data-models.md`. The relationship identification logic will operate on the Go structs created in story 1.2.
- **File Locations**: The relationship identification logic should be implemented in `internal/relations/identifier.go`. [Source: docs/architecture/source-tree.md]
- **Previous Story Insights**: This story depends on the successful parsing of Kubernetes resources from story 1.2.

### Testing
- **Unit Tests**: Unit tests should be created in `_test.go` files in the same package as the code they are testing. [Source: docs/architecture/coding-standards.md]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-01 | 1.0 | Initial draft | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}
### Debug Log References
-
### Completion Notes List
-
### File List
-

## QA Results
-
